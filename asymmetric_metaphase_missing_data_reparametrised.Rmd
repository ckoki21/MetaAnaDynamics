---
title: "Asymmetric metaphase model"
output:
  html_document:
    df_print: paged
---
 

```{r}
rm(list=ls())
#setwd("/Users/constandinakoki/Desktop/Asymmetric_KTs_folder/Rstan_Mitosis/Asymmetric metaphase models modifications")
setwd("/Users/constandinakoki/Library/CloudStorage/OneDrive-UniversityofWarwick/Asymmetric_KTs_folder_mac/Rstan_Mitosis/Asymmetric metaphase models modifications")

library(rstan) 
library(dplyr) 
library(purrr)
library(zoo) 
library(here) 
library(ggplot2) 
library(patchwork)  
library(bayesplot)
library(tidybayes)
library(stringr)
library(readr)
library(tidyr)
library(here)
library(bridgesampling)
library(loo)
library(knitr)
library(writexl)
library(truncnorm)

rstan::rstan_options(auto_write = TRUE) #tries to avoid recompiling stan code
rstan::rstan_options(javascript=FALSE)
options(mc.cores = parallel::detectCores()) #uses as many cores as you h
here::i_am("asymmetric_metaphase_model.Rmd")
source(here::here('R/helper_fns.R'))
source(here::here('R/df_sisters_more.R'))
```


Now we can get started by loading and looking at tracks of kinetochore pairs from one single cell. This data is at a time resolution of approximately 2 s per stack. We plot all the kinetochore pairs that have less than 25% of the observations missing and there are 23 of these in this cell.  

```{r}
K=Inf # 100 restrict to only 50 frames of metaphase #Constandina: I think this is not right. For example in the 

#jobset_str <- here::here("data/OS_LLSM_200818_MC191_Untreated_2.04933s_per_frame/kittracking001-kitjobset_200825_DonaldDuck_auto_v125-OS_LLSM_200818_MC191_Untreated_capture10.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200818_MC191_Untreated_2.04933s_per_frame/kittracking002-kitjobset_200825_DonaldDuck_auto_v125-OS_LLSM_200818_MC191_Untreated_capture11.ome.csv") #----------------->short
#jobset_str <- here::here("data/OS_LLSM_200818_MC191_Untreated_2.04933s_per_frame/kittracking003-kitjobset_200825_DonaldDuck_auto_v125-OS_LLSM_200818_MC191_Untreated_capture12.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200818_MC191_Untreated_2.04933s_per_frame/kittracking004-kitjobset_200825_DonaldDuck_auto_v125-OS_LLSM_200818_MC191_Untreated_capture1.ome.csv")   #----------------->short
#jobset_str <- here::here("data/OS_LLSM_200818_MC191_Untreated_2.04933s_per_frame/kittracking005-kitjobset_200825_DonaldDuck_auto_v125-OS_LLSM_200818_MC191_Untreated_capture2.ome.csv")   #------------------> fails????
#jobset_str <- here::here("data/OS_LLSM_200818_MC191_Untreated_2.04933s_per_frame/kittracking006-kitjobset_200825_DonaldDuck_auto_v125-OS_LLSM_200818_MC191_Untreated_capture5.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200818_MC191_Untreated_2.04933s_per_frame/kittracking007-kitjobset_200825_DonaldDuck_auto_v125-OS_LLSM_200818_MC191_Untreated_capture6.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200818_MC191_Untreated_2.04933s_per_frame/kittracking008-kitjobset_200825_DonaldDuck_auto_v125-OS_LLSM_200818_MC191_Untreated_capture8.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200818_MC191_Untreated_2.04933s_per_frame/kittracking009-kitjobset_200825_DonaldDuck_auto_v125-OS_LLSM_200818_MC191_Untreated_capture9.ome.csv") #-------------------->short


#C:\Users\Constandina\Desktop\Asymmetric KTs\Rstan_Mitosis\Asymmetric metaphase  models modifications\data\OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame

#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking001-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture10.ome.csv") #------------------>short
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking002-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture11.ome.csv") #--------------------> short
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking003-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture12.ome.csv") #------------->short
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking004-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture13.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking005-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture15.ome.csv") #>>>????
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking006-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture16.ome.csv") #>>>>??????????
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking007-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture17.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking008-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture18.ome.csv") #------------------>short
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking009-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture19.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking010-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture20.ome.csv") #----------------->short
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking011-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture24.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking012-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture25.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking013-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture26.ome.csv") #--------------->short
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking014-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture27.ome.csv") #>>>Too many missing data
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking015-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture28.ome.csv") #>>>Too many missing data
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking016-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture29.ome.csv") #----------->short
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking017-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture30.ome.csv")#--------------->missing data & _not_easy_to_define_anaphase
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking018-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture3.ome.csv")  #------------>short
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking019-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture4.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking020-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture5.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking021-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture6.ome.csv")
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking022-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture8.ome.csv") #-------------->short
#jobset_str <- here::here("data/OS_LLSM_200820_MC191_Untreated_2.04933s_per_frame/kittracking023-kitjobset_200827_DonaldDuck_auto_v125-OS_LLSM_200820_MC191_Untreated_capture9.ome.csv")


#######################################3rd folder

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking001-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture10.ome.csv") #------------------->short/NANs

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking002-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture15.ome.csv") #----------------> short

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking003-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture17.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking004-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture19.ome.csv") #------------->short

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking005-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture20.ome.csv")  #----------->short

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking006-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture21.ome.csv") 

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking007-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture25.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking008-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture26.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking009-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture27.ome.csv") #-------------->short

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking010-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture28.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking011-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture3.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking012-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture4.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking013-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture6.ome.csv")  #-------------> short

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking014-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture8.ome.csv")  #------------->short/NANs

#jobset_str <- here::here("data/OS_LLSM_200929_MC191_Untreated_2.04933s_per_frame/kittracking015-kitjobset_210821_DonaldDuck_auto_v313-OS_LLSM_200929_MC191_Untreated_capture9.ome.csv")


######################fourth cell
#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking001-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture11.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking002-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture12.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking003-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture14.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking004-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture15.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking005-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture17.ome.csv") #------------> short/NANs

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking006-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture18.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking007-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture19.ome.csv") 

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking008-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture3.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking009-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture4.ome.csv")  #------------> short

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking010-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture5.ome.csv")

#jobset_str <- here::here("data/OS_LLSM_200930_MC191_Untreated_2.04933s_per_frame/kittracking011-kitjobset_210818_DonaldDuck_auto_v312-OS_LLSM_200930_MC191_Untreated_capture9.ome.csv")  #------------> short


#TAKE JOBSET_NAMES FROM HERE AND ONWARDS!!!!!!!!!!!!!!

#dt=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking001-kitjobset_230404_AI_2023-02-23_Capture12_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv") #~0.92 on average missing data

#dt0=2.24 #only 7 trajectories
#jobset_str <- here::here("data/New_data_per_frame/kittracking001-kitjobset_Al_2023-02-16_Capture10_MC191_488Ndc80EGFP_2-24sec-frames_metaphase_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking002-kitjobset_230404_AI_2023-02-23_Capture14_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking002-kitjobset_Al_2023-02-16_Capture12_MC191_488Ndc80EGFP_2-07sec-frames_metaphase_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking003-kitjobset_230404_AI_2023-02-23_Capture15_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking003-kitjobset_Al_2023-02-16_Capture13_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07 #BAD?
#jobset_str <- here::here("data/New_data_per_frame/kittracking004-kitjobset_230404_AI_2023-02-23_Capture7_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07 #BAD?
#jobset_str <- here::here("data/New_data_per_frame/kittracking004-kitjobset_Al_2023-02-16_Capture14_MC191_488Ndc80EGFP_2-07sec-frames_metaphase_deconvolved.ome.csv")

#dt0=2.07 
#jobset_str <- here::here("data/New_data_per_frame/kittracking005-kitjobset_230404_AI_2023-02-23_Capture9_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking005-kitjobset_Al_2023-02-16_Capture15_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking006-kitjobset_Al_2023-02-16_Capture16_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking007-kitjobset_Al_2023-02-16_Capture17_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.15
#jobset_str <- here::here("data/New_data_per_frame/kittracking008-kitjobset_Al_2023-02-16_Capture4_MC191_488Ndc80EGFP_2-15sec-frames_deconvolved.ome.csv")

#dt0=2.09
#jobset_str <- here::here("data/New_data_per_frame/kittracking009-kitjobset_Al_2023-02-16_Capture6_MC191_488Ndc80EGFP_2-09sec-frames_deconvolved.ome.csv")

#dt0=2.07 #BAD?
#jobset_str <- here::here("data/New_data_per_frame/kittracking010-kitjobset_Al_2023-02-16_Capture7_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking011-kitjobset_Al_2023-02-16_Capture8_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking012-kitjobset_Al_2023-02-17_Capture4_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking013-kitjobset_Al_2023-02-17_Capture5_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking014-kitjobset_Al_2023-02-22_Capture1_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking015-kitjobset_AI_2023-02-22_Capture4_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking016-kitjobset_AI_2023-02-22_Capture5_MC191_488Ndc80EGFP_2-07sec-frames_metaphase_deconvolved.ome.csv")

#dt0=2.07 #only 6 trajectories
#jobset_str <- here::here("data/New_data_per_frame/kittracking017-kitjobset_AI_2023-02-23_Capture1_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking018-kitjobset_AI_2023-02-23_Capture4_MC191_488Ndc80EGFP_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking019-kitjobset_AI_2023-02-23_Capture5_MC191_488Ndc80EGFP_2-07sec-frames_metaphase_deconvolved.ome.csv")


#-------------------------#

#dt0=2.09
#jobset_str <- here::here("data/New_data_per_frame/kittracking003-kitjobset_230406_AI_2023-03-17_Capture4_MC191_488Ndc80EGFP_330nM_Nocodazole_2-09sec-frames_deconvolved.ome.csv")

#dt0 = 1.93
#jobset_str <- here::here("data/New_data_per_frame/kittracking001-kitjobset_230406_AI_2023-03-17_Capture1_MC191_488Ndc80EGFP_330nM_Nocodazole_1-93sec-frames_deconvolved.ome.csv")

#dt0 = 2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking004-kitjobset_230406_AI_2023-03-17_Capture5_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking008-kitjobset_230406_AI_2023-03-22_Capture12_MC191_488Ndc80EGFP_DMSO_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking007-kitjobset_230406_AI_2023-03-22_Capture11_MC191_488Ndc80EGFP_DMSO_2-07sec-frames_deconvolved.ome.csv")


#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking005-kitjobset_230406_AI_2023-03-17_Capture6_MC191_488Ndc80EGFP_DMSO_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking011-kitjobset_230406_AI_2023-03-24_Capture14_MC191_488Ndc80EGFP_DMSO_2-07sec-frames_deconvolved.ome.csv")


#dt0=2.07 #only 8 trajectories
#jobset_str <- here::here("data/New_data_per_frame/kittracking010-kitjobset_230406_AI_2023-03-22_Capture4_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking016-kitjobset_230406_AI_2023-03-24_Capture9_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking002-kitjobset_230406_AI_2023-03-17_Capture3_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking006-kitjobset_230406_AI_2023-03-17_Capture7_MC191_488Ndc80EGFP_DMSO_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07 #BAD
#jobset_str <- here::here("data/New_data_per_frame/kittracking004-kitjobset_230406_AI_2023-03-17_Capture5_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07 #BAD
#jobset_str <- here::here("data/New_data_per_frame/kittracking009-kitjobset_230406_AI_2023-03-22_Capture3_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved.ome.csv")


#dt0=2.07 #BAD
#jobset_str <- here::here("data/New_data_per_frame/kittracking012-kitjobset_230406_AI_2023-03-24_Capture2_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved.ome.csv")


#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking015-kitjobset_230406_AI_2023-03-24_Capture8_MC191_488Ndc80EGFP_330nM_Nocodazole_2-09sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking014-kitjobset_230406_AI_2023-03-24_Capture7_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_data_per_frame/kittracking013-kitjobset_230406_AI_2023-03-24_Capture3_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved.ome.csv")



#New nocodazole data


#dt0=2.07
#jobset_str <- here::here("data/New_nocodazole_data_per_frame/kittracking001-kitjobset_230621_2023-04-21_Capture8_AI_2023-04-21_Capture8_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")


#dt0=2.07
#jobset_str <- here::here("data/New_nocodazole_data_per_frame/kittracking001-kitjobset_230621_2023-04-21_Capture9_AI_2023-04-21_Capture9_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_nocodazole_data_per_frame/kittracking001-kitjobset_230621_2023-04-21-Capture5_AI_2023-04-21_Capture5_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_nocodazole_data_per_frame/kittracking001-kitjobset_230621_2023-05-04_Capture11_AI_2023-05-04_Capture11_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_nocodazole_data_per_frame/kittracking001-kitjobset_230621_2023-05-04_Capture12_AI_2023-05-04_Capture12_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")

#dt0=2.07
#jobset_str <- here::here("data/New_nocodazole_data_per_frame/kittracking001-kitjobset_230621_2023-05-11_Capture1_AI_2023-05-11_Capture1_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")

#dt0=1.94
#jobset_str <- here::here("data/New_nocodazole_data_per_frame/kittracking001-kitjobset_230621_2023-05-11_Capture2_AI_2023-05-11_Capture2_MC191_488Ndc80EGFP_330nM_Nocodazole_1-94sec-frames_deconvolved_5days.ome.csv")

#
#dt0=2.07
#jobset_str <- here::here("data/New_nocodazole_data_per_frame/kittracking001-kitjobset_230702_2023-05-16_Capture8_AI_2023-05-16_Capture8_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")



#############################New data 2#########################################
#dt0=2.07
#jobset_str <- here::here("data/New_data2_per_frame/kittracking001-kitjobset_230615_2023_04_20_Capture10_AI_Capture10_DMSO_2-07sec-frames_5days.ome.csv")


#BAD
#dt0=2.07 #only 1 pair
#jobset_str <- here::here("data/New_data2_per_frame/kittracking002-kitjobset_230722_AI_2023-04-20_Capture3_Nocodazole_2-07sec-frames_t420-t660_5days.ome.csv")
 
 
#dt0=1.94 #short ???
#jobset_str <- here::here("data/New_data2_per_frame/kittracking003-kitjobset_230801_AI_2023-04-20_Capture4_Nocodazole_1-94sec-frames_t340-t500_5days.ome.csv")
 
 
# dt0=2.07 #is it short?
# jobset_str <- here::here("data/New_data2_per_frame/kittracking004-kitjobset_230722_AI_2023-04-20_Capture6_Nocodazole_2-07sec-frames_t150-t310_5days.ome.csv")
 
 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking005-kitjobset_230615_AI_2023-04-21_Capture16_DMSO_2-07sec-frames_5days.ome.csv")
 
# BAD 
# dt0=1.94 #only 3 pairs, short metaphase time
# jobset_str <- here::here("data/New_data2_per_frame/kittracking006-kitjobset_230801_AI_2023-04-21_Capture1_Nocodazole_1-94sec-frames_t450-t600_5days.ome.csv")
 
 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking012-kitjobset_230802_AI_2023-05-04_Capture18_DMSO_2-07sec-frames_5days.ome.csv")
 
 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking013-kitjobset_230802_AI_2023-05-04_Capture1_Nocodazole_2-07sec-frames_t180-t350_5days.ome.csv")
 
 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking014-kitjobset_230802_AI_2023-05-04_Capture6_Nocodazole_2-07sec-frames_t300-t500_5days.ome.csv")
 

#BAD
# dt0=2.07 #Not good trajectories
# jobset_str <- here::here("data/New_data2_per_frame/kittracking015-kitjobset_230802_AI_2023-05-04_Capture8_Nocodazole_2-07sec-frames_t150-t350_5days.ome.csv")

#BAD
# dt0=2.07 #Only 6 trajectories #maybe short metaphase!
# jobset_str <- here::here("data/New_data2_per_frame/kittracking016-kitjobset_230802_AI_2023-05-10_Capture10_Nocodazole_2-07sec-frames_t240-t420_5days.ome.csv")

 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking017-kitjobset_230803_AI_2023-05-10_Capture11_Nocodazole_2-07sec-frames_t200-t360_5days.ome.csv")
 

# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking018-kitjobset_230802_AI_2023-05-10_Capture13_DMSO_2-07sec-frames_t250-t450_5days.ome.csv")

  
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking019-kitjobset_230803_AI_2023-05-10_Capture1_Nocodazole_2-07sec-frames_t250-t400_5days.ome.csv")

  
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking021-kitjobset_230803_AI_2023-05-10_Capture4_Nocodazole_2-07sec-frames_t150-t310_5days.ome.csv")

# BAD
# dt0=2.07 #only 6 trajectories
# jobset_str <- here::here("data/New_data2_per_frame/kittracking022-kitjobset_230803_AI_2023-05-10_Capture4_Nocodazole_2-07sec-frames_t250-t450_5days.ome.csv")
 

# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking023-kitjobset_230803_AI_2023-05-10_Capture5_Nocodazole_2-07sec-frames_t90-t270_5days.ome.csv")

 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking024-kitjobset_230728_AI_2023-05-10_Capture6_Nocodazole_2-07sec-frames_t350-t550_5days.ome.csv")

#BAD 
#dt0=2.07 #not one good trajectory #very trajectories with anaphase (as a single sister)
# jobset_str <- here::here("data/New_data2_per_frame/kittracking025-kitjobset_230803_AI_2023-05-10_Capture7_Nocodazole_2-07sec-frames_t250-t450_5days.ome.csv")

 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking026-kitjobset_230803_AI_2023-05-11_Capture10_Nocodazole_2-07sec-frames_t1-t250_5days.ome.csv")

  
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking027-kitjobset_230801_AI_2023-05-11_Capture18_Nocodazole_2-07sec-frames_t100-t300_5days.ome.csv")
 

# dt0=2.07 #same cell as the next one (kitt35) but trimmed
# jobset_str <- here::here("data/New_data2_per_frame/kittracking029-kitjobset_230728_AI_2023-05-11_Capture22_DMSO_2-07sec-frames_flowdec_t90-t290_5days.ome.csv")

# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking035-kitjobset_240303_All_CFAR_dt2-AI_2023-05-11_Capture22_DMSO_2-07sec-frames_5days.ome.csv")

#BAD  
# dt0=1.94 #only 8 trajectories #short metaphase
# jobset_str <- here::here("data/New_data2_per_frame/kittracking030-kitjobset_230803_AI_2023-05-11_Capture2_Nocodazole_1-94sec-frames_t250-t400_5days.ome.csv")

#BAD  
# dt0=2.07 #not even one good paired trajectory #short metaphase
# jobset_str <- here::here("data/New_data2_per_frame/kittracking032-kitjobset_230803_AI_2023-05-11_Capture3_Nocodazole_2-07sec-frames_t200-t390_5days.ome.csv")

#BAD  
# dt0=2.07 #only 6 trajectories 
# jobset_str <- here::here("data/New_data2_per_frame/kittracking033-kitjobset_230803_AI_2023-05-11_Capture9_Nocodazole_2-07sec-frames_t250-t400_5days.ome.csv")

 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking034-kitjobset_230803_AI_2023-05-11_Capture8_Nocodazole_2-07sec-frames_t200-t380_5days.ome.csv")

#BAD?  
# dt0=2.07 #not going to anaphase !!! not good oscillations
# jobset_str <- here::here("data/New_data2_per_frame/kittracking035-kitjobset_230728_AI_2023-05-16_Capture12_Nocodazole_2-07sec-frames_t150-t250_5days.ome.csv")

#BAD 
# dt0=2.07 #Not even one good paired trajectory #short metaphase
# jobset_str <- here::here("data/New_data2_per_frame/kittracking036-kitjobset_230728_AI_2023-05-16_Capture13_DMSO_2-07sec-frames_t400-t540_5days.ome.csv")

 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking037-kitjobset_230803_AI_2023-05-16_Capture4_Nocodazole_2-07sec-frames_t200-t330_5days.ome.csv")

#BAD  
# dt0=2.07 #only 4 trajecctories
# jobset_str <- here::here("data/New_data2_per_frame/kittracking038-kitjobset_230803_AI_2023-05-16_Capture5_Nocodazole_2-07sec-frames_t200-t440_5days.ome.csv")

  
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking040-kitjobset_230801_AI_2023-05-16_Nocodazole_2-07sec-frames_t200-t350_5days.ome.csv")

 
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking041-kitjobset_230801_AI_2023-05-16_Capture7_Nocodazole_2-07sec-frames_t400-t540_5days.ome.csv")

  
# dt0=2.07
# jobset_str <- here::here("data/New_data2_per_frame/kittracking043-kitjobset_230803_AI_2023-05-16_Capture9_Nocodazole_2-07sec-frames_t100-t330_5days.ome.csv")

#BAD  
# dt0=2.07 #only 6 trajectories
# jobset_str <- here::here("data/New_data2_per_frame/kittracking044-kitjobset_230803_AI_2023-05-17_Capture2_Nocodazole_2-07sec-frames_t350-t590_5days.ome.csv")

#BAD
# dt0=2.07 #not even one paired trajectory #not going to anaphase?
# jobset_str <- here::here("data/New_data2_per_frame/kittracking045-kitjobset_230803_AI_2023-05-17_Capture4_Nocodazole_2-07sec-frames_t100-t300_5days.ome.csv")

#BAD  
# dt0=2.07 #only 1 good trajectory #short metaphase
# jobset_str <- here::here("data/New_data2_per_frame/kittracking046-kitjobset_230801_AI_2023-05-17_Capture6_Nocodazole_2-07sec-frames_t300-t500_5days.ome.csv")


######################### #New_untrimmed Nocodazole data ######################



# dt0=2.07 #only one trajectory
# jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking001-kitjobset_240318_All_CFAR_dt2-AI_2023-04-20_Capture3_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")

# dt0=1.94 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking002-kitjobset_240318_All_CFAR_dt2-AI_2023-04-20_Capture4_Nocodazole_1-94sec-frames_deconvolved_5days.ome.csv")
 
#  dt0=2.07 #only 8 trajectories
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking003-kitjobset_240318_All_CFAR_dt2-AI_2023-04-21_Capture1_Nocodazole_1-94sec-frames_deconvolved_5days.ome.csv")
  
 
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking004-kitjobset_240318_All_CFAR_dt2-AI_2023-04-21_Capture5_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
  
# dt0=2.07 
# jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking005-kitjobset_240318_All_CFAR_dt2-AI_2023-04-21_Capture8_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
 
  
# dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking006-kitjobset_240318_All_CFAR_dt2-AI_2023-04-21_Capture9_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
 
#  dt0=2.07 
#jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking007-kitjobset_240318_All_CFAR_dt2-AI_2023-05-04_Capture11_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking008-kitjobset_240318_All_CFAR_dt2-AI_2023-05-04_Capture12_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
 
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking009-kitjobset_240318_All_CFAR_dt2-AI_2023-05-04_Capture1_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#    dt0=2.07 
# jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking010-kitjobset_240318_All_CFAR_dt2-AI_2023-05-04_Capture6_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#    dt0=2.07 #too many missing data
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking011-kitjobset_240318_All_CFAR_dt2-AI_2023-05-04_Capture8_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
 
#   dt0=2.07 #too many missing data -- only 8 trajectories
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking012-kitjobset_240318_All_CFAR_dt2-AI_2023-05-10_Capture10_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking013-kitjobset_240318_All_CFAR_dt2-AI_2023-05-10_Capture11_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")

 
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking014-kitjobset_240318_All_CFAR_dt2-AI_2023-05-10_Capture1_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking015-kitjobset_240318_All_CFAR_dt2-AI_2023-05-10_Capture2_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 
 # jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking016-kitjobset_240318_All_CFAR_dt2-AI_2023-05-10_Capture4bottom_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")

#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking017-kitjobset_240318_All_CFAR_dt2-AI_2023-05-10_Capture4top_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
 #  dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking018-kitjobset_240318_All_CFAR_dt2-AI_2023-05-10_Capture5_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking019-kitjobset_240318_All_CFAR_dt2-AI_2023-05-11_Capture10_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 #only 9 trajectories
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking020-kitjobset_240318_All_CFAR_dt2-AI_2023-05-11_Capture18_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
 #  dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking021-kitjobset_240318_All_CFAR_dt2-AI_2023-05-11_Capture1_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=1.94 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking022-kitjobset_240318_All_CFAR_dt2-AI_2023-05-11_Capture2bottom_Nocodazole_1-94sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking023-kitjobset_240318_All_CFAR_dt2-AI_2023-05-11_Capture2top_Nocodazole_1-94sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 #too many missing data
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking024-kitjobset_240318_All_CFAR_dt2-AI_2023-05-11_Capture3_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 
# jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking025-kitjobset_240318_All_CFAR_dt2-AI_2023-05-11_Capture8_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 #only 5 trajectories
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking026-kitjobset_240318_All_CFAR_dt2-AI_2023-05-11_Capture9_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 #too many missing data
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking027-kitjobset_240318_All_CFAR_dt2-AI_2023-05-16_Capture4_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#  dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking028-kitjobset_240318_All_CFAR_dt2-AI_2023-05-16_Capture5_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
 #   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking029-kitjobset_240318_All_CFAR_dt2-AI_2023-05-16_Capture6bottom_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#    dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking030-kitjobset_240318_All_CFAR_dt2-AI_2023-05-16_Capture6top_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking031-kitjobset_240318_All_CFAR_dt2-AI_2023-05-16_Capture8_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#    dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking032-kitjobset_240318_All_CFAR_dt2-AI_2023-05-16_Capture9_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#     dt0=2.07 #only 6 trajectories
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking033-kitjobset_240318_All_CFAR_dt2-AI_2023-05-17_Capture2_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#     dt0=2.07 #not even one good trajectory
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking034-kitjobset_240318_All_CFAR_dt2-AI_2023-05-17_Capture4_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
  
#      dt0=2.07 #not even one good trajectory
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking035-kitjobset_240318_All_CFAR_dt2-AI_2023-05-17_Capture6_Nocodazole_2-07sec-frames_deconvolved_5days.ome.csv")
 
#dt0=1.93 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking036-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-17_Capture1_MC191_488Ndc80EGFP_330nM_Nocodazole_1-93sec-frames_deconvolved_5_days_sigma.ome.csv")

 
# dt0=2.09
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking037-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-17_Capture4_MC191_488Ndc80EGFP_330nM_Nocodazole_2-09sec-frames_deconvolved_5_days_sigma.ome.csv")
 
 
# dt0=2.09
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking038-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-24_Capture8_MC191_488Ndc80EGFP_330nM_Nocodazole_2-09sec-frames_deconvolved_5_days_sigma.ome.csv")
 
 
# dt0=2.07
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking039-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-24_Capture9_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
 
 
# dt0=2.07 #only 5 good trajectories
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking040-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-05-16_Capture7_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
  
#   dt0=2.07 #
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking041-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-17_Capture3_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
#  dt0=2.07 # only 7 trajectories
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking042-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-17_Capture5_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
#   dt0=2.07 #not even one good trajectory
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking043-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-22_Capture3_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
#  dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking044-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-22_Capture4_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
#   dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking045-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-24_Capture2_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
 # dt0=2.07 
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking046-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-04-20_Capture6_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
#   dt0=2.07 # difficult to define anaphase --- only one sister shown or none!
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking047-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-05-10_Capture6_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
#   dt0=2.07 #only 6 trajectories
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking048-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-05-10_Capture7_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
  
#    dt0=2.07 #nt good
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking049-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-05-16_Capture12_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
#   dt0=2.07 #
#  jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking050-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-24_Capture3_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
#  dt0=2.07 #only 1 good trajectory
#jobset_str <- here::here("data/New_nocodazole_untrimmed_per_frame/kittracking051-kitjobset_240318_Nocodazole_All_CFAR_dt2-AI_2023-03-24_Capture7_MC191_488Ndc80EGFP_330nM_Nocodazole_2-07sec-frames_deconvolved_5_days_sigma.ome.csv")
  
 
 
 ##############DMSO UNTRIMMED CFAR DATA####################################
 
#   dt0=2.58 #short
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking001-kitjobset_240303_All_CFAR_dt2-AI_2022-12-01_Capture11_2-58sec-frames.ome.csv")
  
#   dt0=2.58 
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking002-kitjobset_240303_All_CFAR_dt2-AI_2022-12-01_Capture15_2-58sec-frames.ome.csv")
 
#  dt0=1.93 #short
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking003-kitjobset_240303_All_CFAR_dt2-AI_2022-12-01_Capture16_1-93sec-frames.ome.csv")
 
# dt0=2.15
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking004-kitjobset_240303_All_CFAR_dt2-AI_2022-12-01_Capture2_2-15sec-frames.ome.csv")
 
 
#   dt0=2.15 #no anaphase
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking005-kitjobset_240303_All_CFAR_dt2-AI_2022-12-01_Capture7_2-15sec-frames.ome.csv")
 
 
#  dt0=2.15
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking006-kitjobset_240303_All_CFAR_dt2-AI_2022-12-01_Capture9_2-15sec-frames.ome.csv")
  
  
#  dt0=2.24
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking007-kitjobset_240303_All_CFAR_dt2-AI_2023-02-16_Capture10_2-24sec-frames_metaphase_5days.ome.csv")
 
#   dt0=2.07 #no good trajectories
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking008-kitjobset_240303_All_CFAR_dt2-AI_2023-02-16_Capture12_2-07sec-frames_metaphase_5days.ome.csv")
 
 
   dt0=2.07
 jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking009-kitjobset_240303_All_CFAR_dt2-AI_2023-02-16_Capture13_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking010-kitjobset_240303_All_CFAR_dt2-AI_2023-02-16_Capture15_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.07 #no good trajectories
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking011-kitjobset_240303_All_CFAR_dt2-AI_2023-02-16_Capture16_2-07sec-frames_5days.ome.csv")
 
#  dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking012-kitjobset_240303_All_CFAR_dt2-AI_2023-02-16_Capture17_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.15
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking013-kitjobset_240303_All_CFAR_dt2-AI_2023-02-16_Capture4_2-15sec-frames_5days.ome.csv")
 

#   dt0=2.09
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking014-kitjobset_240303_All_CFAR_dt2-AI_2023-02-16_Capture6_2-09sec-frames_5days.ome.csv")
 
 
#  dt0=2.07
#  jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking015-kitjobset_240303_All_CFAR_dt2-AI_2023-02-16_Capture8_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking016-kitjobset_240303_All_CFAR_dt2-AI_2023-02-17_Capture4_2-07sec-frames_5days.ome.csv")
 
#  dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking017-kitjobset_240303_All_CFAR_dt2-AI_2023-02-17_Capture5_2-07sec-frames_5days.ome.csv")
 
#  dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking018-kitjobset_240303_All_CFAR_dt2-AI_2023-02-22_Capture1_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.58
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking019-kitjobset_240303_All_CFAR_dt2-AI_2023-02-22_Capture4_2-58sec-frames_5days.ome.csv")
 
#   dt0=2.07
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking020-kitjobset_240303_All_CFAR_dt2-AI_2023-02-22_Capture5_2-07sec-frames_metaphase_5days.ome.csv")
 
#   dt0=2.07 #no good trajectories
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking021-kitjobset_240303_All_CFAR_dt2-AI_2023-02-23_Capture12_2-07sec-frames_5days.ome.csv")

#   dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking022-kitjobset_240303_All_CFAR_dt2-AI_2023-02-23_Capture14_2-07sec-frames_5days.ome.csv")

#   dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking023-kitjobset_240303_All_CFAR_dt2-AI_2023-02-23_Capture15_2-07sec-frames_5days.ome.csv")
 
#  dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking024-kitjobset_240303_All_CFAR_dt2-AI_2023-02-23_Capture1_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking025-kitjobset_240303_All_CFAR_dt2-AI_2023-02-23_Capture4_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.07 #only 7 trajectories
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking026-kitjobset_240303_All_CFAR_dt2-AI_2023-02-23_Capture5_2-07sec-frames_metaphase_5days.ome.csv")
 
#   dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking027-kitjobset_240303_All_CFAR_dt2-AI_2023-03-17_Capture6_DMSO_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking028-kitjobset_240303_All_CFAR_dt2-AI_2023-03-22_Capture11_DMSO_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.07 #no good trajectories
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking029-kitjobset_240303_All_CFAR_dt2-AI_2023-03-22_Capture12_DMSO_2-07sec-frames_5days.ome.csv")
 
 
 #   dt0=2.07
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking030-kitjobset_240303_All_CFAR_dt2-AI_2023-03-24_Capture14_DMSO_2-07sec-frames_flowdec_5days.ome.csv")
 
#  dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking031-kitjobset_240303_All_CFAR_dt2-AI_2023-04-20_Capture10_DMSO_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.07
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking032-kitjobset_240303_All_CFAR_dt2-AI_2023-04-21_Capture16_DMSO_2-07sec-frames_5days.ome.csv")
 
 #  dt0=2.07
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking033-kitjobset_240303_All_CFAR_dt2-AI_2023-05-04_Capture18_DMSO_2-07sec-frames_5days.ome.csv")
 
 #   dt0=2.07
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking034-kitjobset_240303_All_CFAR_dt2-AI_2023-05-10_Capture13_DMSO_2-07sec-frames_5days.ome.csv")
 
#   dt0=2.07
#jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking035-kitjobset_240303_All_CFAR_dt2-AI_2023-05-11_Capture22_DMSO_2-07sec-frames_flowdec_5days.ome.csv")
 
#    dt0=2.07 #not good trajectories
# jobset_str <- here::here("data/DMSO_data_CFAR_per_frame/kittracking036-kitjobset_240303_All_CFAR_dt2-AI_2023-05-16_Capture13_DMSO_2-07sec-frames_5days.ome.csv")


```



```{r}

proportional_missing = 1
whole_name=str_split(jobset_str,"per_frame/kittracking0")
#wl = str_split(whole_name[[1]][2],"Untreated")[[1]][1]
split_name=str_split(whole_name[[1]][2],".ome.csv")
cell_name=paste(split_name[[1]][1], sep="")
split_name= str_split(cell_name,"-kitjobset")
cell_name=paste(split_name[[1]][1], sep="")

Missing_positions <- how_much_missing(jobset_str, max_mis_prop = proportional_missing)
Missing_positions2 = Missing_positions %>% select( SisterPairID,SisterID,proportionNaN, which_missing) %>% mutate(new = as.character(which_missing), .keep = "unused")
#write_xlsx(Missing_positions2,here::here(paste0("Missingpositions_",wl,".xlsx")))

whole_name2 = str_split(jobset_str,"per_frame/")[[1]][2]
whole_name2 = str_split(whole_name2,".ome.csv")[[1]][1]

 all_data = process_jobset_keep_missing(jobset_str,K=K,max_missing=1) %>%
  filter(!is.na(SisterID))
 length(unique(all_data$SisterPairID))
 
################################################################################
 
data_single_pair <- process_jobset_keep_missing(jobset_str,K=Inf, start_from = 0,max_missing = proportional_missing) %>%
  filter(!is.na(SisterID)) #omit unpaired KTs
 length(unique(data_single_pair$SisterPairID))
 
 yz_plot <- ggplot(data_single_pair, aes(x=Position_2, y=Position_3,color=factor(SisterPairID))) +
  geom_line(alpha = 0.4)+ 
  geom_point(alpha = 0.7, size = 0.3)+ 
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90)) +theme_bw()+
  labs(x="Y-axis",y="Z-axis")+scale_color_discrete(name = "Sister Pair ID")
 ggsave(here::here(gsub("","",paste0("Plots_new_data/xy_including_missing_",cell_name,split_name[[1]][2],".pdf"))),width = 22, height = 20)

 g <- ggplot(data_single_pair, aes(x=Time, y=Position_1,color=factor(SisterID))) +
  geom_line() +
  facet_wrap(.~SisterPairID) +
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90)) +
  labs(x="Time (s)",y="Position (um)")
g


p_missing_final = 0.2
prop_missing_initial =0.3
p_missing_interpolate = 0.25
data_single_pair_old = process_jobset_keep_missing(jobset_str,K=Inf, start_from = 0,max_missing = p_missing_interpolate) %>%
  filter(!is.na(SisterID)) #omit unpaired KTs
 length(unique(data_single_pair_old$SisterPairID))
 
 
data_single_pair = filter_cell_data(jobset_str, max_anaphase_frames = 45, p_missing_final = p_missing_final, prop_missing = prop_missing_initial)
 length(unique(data_single_pair$SisterPairID))
  
 
#  data_single_pair %>% group_by(Time,Frame,SisterPairID) %>% mutate(Ymean = mean(Position_2), Zmean = mean(Position_3))%>%filter(SisterPairID ==36) %>% ggplot(aes(x= Ymean, y=Zmean,color=Frame)) +
# #  geom_line(alpha = 0.4)+ 
#   geom_point(alpha = 0.7)+ 
#   theme_bw() +
#   theme(legend.position = "None",
#         strip.text.x = element_text(size = 8),
#         axis.text.x = element_text(angle=90)) +theme_bw()+
#   labs(x="Y-axis",y="Z-axis")+scale_color_discrete(name = "Sister Pair ID")
# 
#  
y_time_series <- ggplot(data_single_pair, aes(x= Time, y=Position_2,color=factor(SisterID))) + facet_wrap(~SisterPairID)+
  geom_line()+ 
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90)) +theme_bw()+
  labs(x="Time (s)",y="Y_axis")+scale_color_discrete(name = "Sister Pair ID")

 y_time_series
 
  yz_plot <- data_single_pair %>% group_by(Time,Frame,SisterPairID) %>% mutate(Ymean = mean(Position_2), Zmean = mean(Position_3)) %>% ggplot(aes(x= Ymean, y=Zmean,color=factor(SisterPairID))) +
  geom_line(alpha = 0.4)+ 
  geom_point(alpha = 0.7, size= 0.3)+ 
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90)) +theme_bw()+
  labs(x="Y-axis",y="Z-axis")+scale_color_discrete(name = "Sister Pair ID")
 ggsave(here::here(gsub("","",paste0("Plots_new_data/xy_0.2missing_",cell_name,split_name[[1]][2],".pdf"))),width = 22, height = 20)
 
 
 
g <- ggplot(data_single_pair, aes(x=Time, y=Position_1,color=factor(SisterID))) +
  geom_line() +
  facet_wrap(.~SisterPairID) +
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90)) +
  labs(x="Time (s)",y="Position (um)")
g
################################################################################ 

ggsave(here::here(gsub("","",paste0("Plots_new_data/Trajectories_cell_",cell_name,split_name[[1]][2],".pdf"))),width = 22, height = 20)
  
   
  
    data_1 = data_single_pair %>% filter(SisterID == 1) 
    data_2 = data_single_pair %>% filter(SisterID == 2) 
    df_test = cbind(data_1$SisterPairID, data_1$Position_1,data_2$Position_1, data_1$Frame, data_1$Time)
    colnames(df_test)=c("SisterPairID","X1","X2","Frame","Time")
    df_test = as.data.frame(df_test)
    df_test = df_test %>% rowwise() %>% mutate(Mean_position = mean(c(X1, X2)))
  
#This makes the autocorellation based on the mean position of two sisters
    df_acf <-df_test %>%
      split(.$SisterPairID) %>% 
      map(~acf(.$Mean_position , main = unique(.$SisterPairID), lag.max = 150, plot = F,na.action=na.pass))%>%
      map_dfr(~data.frame(lag = .$lag, acf = .$acf, ci = qnorm(0.975)/sqrt(.$n.used)), .id = "SisterPairID")
    
    
h = ggplot(df_acf, aes(lag, acf))+  geom_line() +
#  geom_segment(aes(xend = lag, yend = 0)) +
  geom_hline(aes(yintercept = ci), linetype = "dashed", color = "deepskyblue2") +
  geom_hline(aes(yintercept = -ci), linetype = "dashed", color = "deepskyblue2") +
  facet_wrap(~SisterPairID)+
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90))+
  labs(x="Lags",y="Autocorrelation")
h
ggsave(here::here(gsub("","",paste0("Autocorrelations_cell_",cell_name,split_name[[1]][2],"NAN_included.pdf"))))


```


#This makes the autocorellation based only on the position of Sister 1    
df_acf <-data_single_pair %>% filter(SisterID == 1) %>%
      split(.$SisterPairID) %>% 
      map(~acf(.$Position_1 , main = unique(.$SisterPairID), lag.max = 150, plot = F,na.action=na.pass))%>%
      map_dfr(~data.frame(lag = .$lag, acf = .$acf, ci = qnorm(0.975)/sqrt(.$n.used)), .id = "SisterPairID")

h = ggplot(df_acf, aes(lag, acf))+  geom_line() +
#  geom_segment(aes(xend = lag, yend = 0)) +
  geom_hline(aes(yintercept = ci), linetype = "dashed", color = "deepskyblue2") +
  geom_hline(aes(yintercept = -ci), linetype = "dashed", color = "deepskyblue2") +
  facet_wrap(~SisterPairID)+
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90))+
  labs(x="Lags",y="Autocorrelation")
h
ggsave(here::here(gsub("","",paste0("Autocorrelations_cell_",cell_name,split_name[[1]][2],"NAN_included.pdf"))))

  #Omit trajectories with NA.
nan_nu = unique(data_single_pair$SisterPairID[is.na(data_single_pair$Position_1)])
all_nu = unique(data_single_pair$SisterPairID[!is.na(data_single_pair$Position_1)])
vec1 <- !all_nu %in% nan_nu
df_non_nan <- data_single_pair %>% filter(SisterPairID %in% all_nu[vec1]) 


df_acf2 <-df_non_nan %>% filter(SisterID == 1) %>%
      split(.$SisterPairID) %>% 
      map(~acf(.$Position_1 , main = unique(.$SisterPairID), lag.max = 150, plot = F))%>%
      map_dfr(~data.frame(lag = .$lag, acf = .$acf, ci = qnorm(0.975)/sqrt(.$n.used)), .id = "SisterPairID")

h2 = ggplot(df_acf, aes(lag, acf))+  geom_line() +
#  geom_segment(aes(xend = lag, yend = 0)) +
  geom_hline(aes(yintercept = ci), linetype = "dashed", color = "deepskyblue2") +
  geom_hline(aes(yintercept = -ci), linetype = "dashed", color = "deepskyblue2") +
  facet_wrap(~SisterPairID)+
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90))+
  labs(x="Lags",y="Autocorrelation")
h
ggsave(here::here(gsub("","",paste0("Autocorrelations_cell_",cell_name,split_name[[1]][2],"no_nan.pdf"))))




We choose one particular pair that we can look at in more detail. 

```{r}
#Sister pairs with no missing data for this particular cell
Complete_sisters=unique(data_single_pair$SisterPairID)

for(i in Complete_sisters){
h <- ggplot(data_single_pair %>% filter(SisterPairID==i), aes(x=Time, y=Position_1,color=factor(SisterID))) +
  geom_line() +
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90)) +
  labs(x="Time (s)",y="Position (um)")
print(h)

}



g <- ggplot(data_single_pair, aes(x=Time, y=Position_1,color=factor(SisterID))) +
  geom_line() +
  facet_wrap(.~SisterPairID) +
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90)) +
  labs(x="Time (s)",y="Position (um)")
g
 ggsave(here::here(gsub(" "," ", paste0("Trajectories_cell_",cell_name,split_name[[1]][2],".pdf"))))

```
First we consider a changepoint model of anaphase onset that ignores the dynamics in metaphase, as described in Armond et al 2019 bioRxiv, https://doi.org/10.1101/582379. This model looks at the distance between a kinetochore pair. In metaphase, it assumes this is constant, and in anaphase it assumes this distance grows linearly. 

We will fit the changepoint model to the experimental data. We want to to find the minimum anaphase time point for all kt-s in the cell 

```{r}
pairs_to_include = unique(data_single_pair$SisterPairID)
data_single_pair_interpolate <- process_jobset(jobset_str,K=K,max_missing=1) %>%
  filter(!is.na(SisterID)) 
#omit unpaired KTs 
data_single_pair_interpolate <- data_single_pair_interpolate %>%filter( SisterPairID %in% (pairs_to_include)) #keep sisters that have pass the criterion of filter_cell_data

pairIDs <- unique(data_single_pair_interpolate$SisterPairID)
K=max(data_single_pair_interpolate$Frame)
  # #Remember this is 2 times the frames because we have data for sister 1 and 2
  #2K=dim(data_single_pair %>% filter(SisterPairID==pairIDs[2]))[1] 
nTracks = length(pairIDs)
y_interpolate= prepare_for_stan_format(data_single_pair_interpolate)
y_interpolate_missing = purrr::map(y_interpolate, is.na) %>% purrr::map(function(x) x[,1] | x[,2])
for (i in 1:length(y_interpolate)) {
    y_interpolate[[i]][y_interpolate_missing[[i]],] <- 0
  } #replace missing values with zero for stan compatibility (stan does not like NA values)
y_interpolate_missing <- purrr::map(y_interpolate_missing,as.integer)
min_tana<-1000
sister_t_ana<-0
anaphase_times<-matrix(0,2,length(pairIDs))
j<-1
for(i in pairIDs){
    stan_input = list(dt=dt0, T=K,
                      nTracks = 1,
                      y = y_interpolate[[which(pairIDs==i)]],
                      y_missing = y_interpolate_missing[[which(pairIDs==i)]]
    )
    changept_estimate <- stan(file=here::here('src/stan_files/anaphase_changepoint.stan'),
                              data=stan_input,
                              seed = 42,
                              chains =4,
	                            warmup = 3000,
         	                    iter = 6000,
                              control=list(adapt_delta=0.95,max_treedepth=12))
#Find the minimum anaphase time for all sisters

    #pars_to_plot = c("tau","alpha","beta","a","t_ana")
    #color_scheme_set("purple")
    posterior <- as.array(changept_estimate)
    #mcmc_trace(posterior,pars=pars_to_plot)
    ch_es<-as.data.frame(changept_estimate)
    min2tana<-mean(ch_es$t_ana)
    anaphase_times[,j]<-c(min2tana,i)
    
##   if (min2tana<min_tana){
##      sister_t_ana<-i
##      min_tana<-min2tana
##    }
##print(j)
##print(i)
##print(min2tana)
##print(min_tana)
##    j<-j+1
##    }
    print(min2tana)
    print(i)
    if(j==1){
    min_tana = min2tana
    df_t_ana<- as.data.frame(ch_es$t_ana)
    names(df_t_ana) = c(i)
  }else{
    min_tana = min_tana+min2tana
    df_t_ana <- cbind(df_t_ana, c(ch_es$t_ana))
    names(df_t_ana)[j] = c(i)
  }
  
  #    if (min2tana<min_tana){
  #   min_tana<-min2tana
  #    sister_t_ana<-i
  #  }
  j<-j+1
}

  min_tana = min_tana/j   #This is the mean anaphase time from all sisters (or we could take the median. We have noticed that there are some sisters
  #with outliers anaphase times and hence minimum is not the right choice. )

  #Another way to go is to replace the outlier with the median time and then find the minimum anaphase time. 
Mean_anaphase = data.frame("Mean_t_ana"= colMeans(df_t_ana),"SisterPairID" = as.numeric(names(df_t_ana))) #Dataframe with mean anaphase times for all sister pairs.
#Remove outliers. I define them as the values which are < than (median(anaphase_times)/2)
Mean_anaphase = Mean_anaphase %>% select(Mean_t_ana)%>%mutate(Mean_anaphase, Mean_t_ana = ifelse((Mean_t_ana< median(Mean_anaphase$Mean_t_ana)-100), median(Mean_anaphase$Mean_t_ana)-30,Mean_t_ana ))

 write_xlsx(Mean_anaphase,here::here(paste0("Mean_anaphase_times_",cell_name,split_name[[1]][2],"_all.xlsx")))
 write.csv(Mean_anaphase,here::here(paste0("Mean_anaphase_times_",whole_name2,".csv")),row.names=FALSE)
 
     #Maybe more accurate to go with median instead of minimum to reduce the effect of a possible outlier/false change point.
    
#better to use the median!!!
  min_tana_new =  median(Mean_anaphase$Mean_t_ana)
 #min_tana_new =  min(Mean_anaphase$Mean_t_ana)

 
 
#!!!!!!!!!!these data are the ones with missing data, without interpolation!!!!!!!!# 
data_single_pair <- data_single_pair[(data_single_pair$Time<floor(min_tana_new-30))==TRUE,]

rm(posterior)  
#rm(pars_to_plot)

```

Plots and quantities needed when looking only at the metaphase window!

```{r}
df_sisters_more_info = get_df_sisters_more(jobset_str, Mean_anaphase, max_anaphase_frames = 45, p_missing_final, prop_missing_initial)

 write_xlsx(df_sisters_more_info,here::here(paste0("Df_sisters_info_more_",whole_name2,"_all.xlsx")))

g <- ggplot(data_single_pair, aes(x=Time, y=Position_1,color=factor(SisterID))) +
  geom_line() +
  facet_wrap(.~SisterPairID) +
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90)) +
  labs(x="Time (s)",y="Position (um)")
g
 ggsave(here::here(gsub(" "," ", paste0("Trajectories_cell_",cell_name,split_name[[1]][2],"_metaphase_only.pdf"))))
 
  
#This makes the autocorellation based on the mean position of two sisters
    df_acf <-df_sisters_more_info %>%
      split(.$SisterPairID) %>% 
      map(~acf(.$Mean_X_sisters , main = unique(.$SisterPairID), lag.max = 150, plot = F,na.action=na.pass))%>%
      map_dfr(~data.frame(lag = .$lag, acf = .$acf, ci = qnorm(0.975)/sqrt(.$n.used)), .id = "SisterPairID")


h = ggplot(df_acf, aes(lag, acf))+  geom_line() +
#  geom_segment(aes(xend = lag, yend = 0)) +
  geom_hline(aes(yintercept = ci), linetype = "dashed", color = "deepskyblue2") +
  geom_hline(aes(yintercept = -ci), linetype = "dashed", color = "deepskyblue2") +
  facet_wrap(~SisterPairID)+
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90))+
  labs(x="Lags",y="Autocorrelation")
h
ggsave(here::here(gsub("","",paste0("Autocorrelations_cell_",cell_name,split_name[[1]][2],"_metaphase_NAN_included.pdf"))))

  #Omit trajectories with NA.
nan_nu = unique(data_single_pair$SisterPairID[is.na(df_sisters_more_info$Mean_X_sisters)])
all_nu = unique(data_single_pair$SisterPairID[!is.na(df_sisters_more_info$Mean_X_sisters)])
vec1 <- !all_nu %in% nan_nu
df_non_nan <- df_sisters_more_info %>% filter(SisterPairID %in% all_nu[vec1]) 

# 
# df_acf2 <-df_non_nan %>%
#       split(.$SisterPairID) %>% 
#       map(~acf(.$Mean_X_sisters, main = unique(.$SisterPairID), lag.max = 150, plot = F,na.action=na.pass))%>%
#       map_dfr(~data.frame(lag = .$lag, acf = .$acf, ci = qnorm(0.975)/sqrt(.$n.used)), .id = "SisterPairID")

#h2 = ggplot(df_acf2, aes(lag, acf))+  geom_line() +
#  geom_segment(aes(xend = lag, yend = 0)) +
#  geom_hline(aes(yintercept = ci), linetype = "dashed", color = "deepskyblue2") +
#  geom_hline(aes(yintercept = -ci), linetype = "dashed", color = "deepskyblue2") +
#  facet_wrap(~SisterPairID)+
#  theme_bw() +
#  theme(legend.position = "None",
#        strip.text.x = element_text(size = 8),
#        axis.text.x = element_text(angle=90))+
#  labs(x="Lags",y="Autocorrelation")
#h2
#ggsave(here::here(gsub("","",paste0("Autocorrelations_cell_",cell_name,split_name[[1]][2],"_metaphase_no_nan.pdf"))))
   

#Seconds instead of frames in lags.
df_acf_seconds <- df_acf %>% select(lag) %>%  mutate(df_acf, seconds = lag*2.04933, .keep = "all")

h = ggplot(df_acf_seconds, aes(seconds, acf))+  geom_line() +
#  geom_segment(aes(xend = lag, yend = 0)) +
  geom_hline(aes(yintercept = ci), linetype = "dashed", color = "deepskyblue2") +
  geom_hline(aes(yintercept = -ci), linetype = "dashed", color = "deepskyblue2") +
  facet_wrap(~SisterPairID)+
  theme_bw() +
  theme(legend.position = "None",
        strip.text.x = element_text(size = 8),
        axis.text.x = element_text(angle=90))+
  labs(x="Time(s)",y="Autocorrelation")
h
ggsave(here::here(gsub("","",paste0("Autocorrelations_cell_",cell_name,split_name[[1]][2],"_metaphase_NAN_included_seconds.pdf"))))
 write.csv(df_acf_seconds,here::here(paste0("Autocorrelations_seconds_metaphase_nan_included_",whole_name2,".csv")),row.names=FALSE)

  #Omit trajectories with NA.
# df_acf_seconds2 <- df_acf2 %>% select(lag) %>%  mutate(df_acf2, seconds = lag*2.04933, .keep = "all")
# 
# h2 = ggplot(df_acf_seconds2, aes(seconds, acf))+  geom_line() +
# #  geom_segment(aes(xend = lag, yend = 0)) +
#   geom_hline(aes(yintercept = ci), linetype = "dashed", color = "deepskyblue2") +
#   geom_hline(aes(yintercept = -ci), linetype = "dashed", color = "deepskyblue2") +
#   facet_wrap(~SisterPairID)+
#   theme_bw() +
#   theme(legend.position = "None",
#         strip.text.x = element_text(size = 8),
#         axis.text.x = element_text(angle=90))+
#   labs(x="Time(s)",y="Autocorrelation")
# h
# ggsave(here::here(gsub("","",paste0("Autocorrelations_cell_",cell_name,split_name[[1]][2],"_metaphase_no_nan_seconds.pdf"))))
# 
# write_xlsx(df_acf_seconds,here::here(paste0("Autocorrelations_seconds_",cell_name,split_name[[1]][2],"_metaphase.xlsx")))
 write.csv(df_acf_seconds,here::here(paste0("Autocorrelations_seconds_metaphase_only",whole_name2,".csv")),row.names=FALSE)
 
```


Remember "data_single_pair" have missing data and we treat them with reduced likelihood

```{r}

  pairIDs <- unique(data_single_pair$SisterPairID)
  y = prepare_for_stan_format(data_single_pair)
  y_missing = purrr::map(y, is.na) %>% purrr::map(function(x) x[,1] | x[,2])
  for (i in 1:length(y)) {
    y[[i]][y_missing[[i]],] <- 10^9
  } #replace missing values high values--- see also in .stan file to treat missing (stan does not like NA values)
  y_missing <- purrr::map(y_missing,as.integer)
  K=max(data_single_pair$Frame)
  ########################Bridge Sampling############################################
  Marginal_likelihoods_bridge <- data.frame(SisterPairID=integer(length(pairIDs)),Full=double(length(pairIDs)), v_minus=double(length(pairIDs)), v_plus=double(length(pairIDs)),v_minus_plus=double(length(pairIDs)),symmetric=double(length(pairIDs)))
######################################################################################
     Bayes_Factors_bridge <- data.frame(SisterPairID=integer(length(pairIDs)),Full=double(5*length(pairIDs)), v_minus=double(5*length(pairIDs)), v_plus=double(5*length(pairIDs)),v_minus_plus=double(5*length(pairIDs)),symmetric=double(5*length(pairIDs)),post_prob=double(5*length(pairIDs)))
###########################################################################################

# divergent_chains_sisters_warm = matrix(NA,nrow=length(pairIDs) ,ncol=6)     
# divergent_chains_sisters_no_warm = matrix(NA,nrow=length(pairIDs) ,ncol=6)
j=1
model=1
warm_up_iter = 8000
total_iter = 12000
for(i in pairIDs){
  Marginal_likelihoods_bridge[j,1]=i
# Elpd_estimate[j,1]=i
# DF_Loo_cv[2*j-1:2*j,1]=i
  trajectory_index <- which(pairIDs==i)
  start_end <- purrr::map_df(y_missing,get_start_end_of_nonmissing_data,.id="traj_index") %>%
  mutate(traj_index=as.integer(traj_index)) #use this info to only fit to the existing tracks
  cos_theta <- get_cos_theta(data_single_pair,pairIDs[trajectory_index])
  cos_theta[is.na(cos_theta)] <- 0 #replace NAs as stan does not deal with these, should not come into the fit due to T0 and T1
  T0 = start_end %>% filter(traj_index==trajectory_index) %>% pull(T0);
  T1 = start_end %>% filter(traj_index==trajectory_index) %>% pull(T1);
  Frames=K
  sigma0 = c(0.0,0.5,0.5,0.0)
  stan_input = list(dt=dt0, Frames=K, nStates = 4,
                    y = y[[trajectory_index]],
                    y_missing = y_missing[[trajectory_index]],
                    sigma0 =sigma0, #initial state probabilities
                    T0 =T0, #shall i say T0=T0 based on lines 205,206?
                    T1 = T1,cos_theta = cos_theta )

  #Asymmetric metaphase model
  model=1
  stan_file= here::here('src/stan_reparametrise_missing/metaphase_asymmetric_full_likelihood_reparametrised_missing.stan') #Asymmetry in all variables   (v+,v-,tau)
      m <- stan_model(stan_file) #slightly different way to call a stan model, this compiles the model and the next line does the sampling
    estimate_asym1 <- sampling(m,
                              data=stan_input,
                              seed = 42,
                              chains = 4,
	                            warmup = warm_up_iter,
         	                    iter = total_iter,
                              init_r=0.1,
                              pars = c("f","eta","xi","auxStates","P","aux"),
                              include=FALSE, #avoid saving the params listed above
                              control=list(adapt_delta=0.95,
                                           max_treedepth=12))
    name2save <- paste("Asymmetric_full_vminus_vplus_tau_",whole_name2,"_pair_",i,".rds",sep="")       
    saveRDS(estimate_asym1,here::here(name2save))          
     ############################################################################    
    #first check the convergence and ESS etc etc and get rid of the kt with issues
    bridge1<-bridge_sampler(estimate_asym1)
    print(bridge1$logml)
    #bridge1=bridge_sampler(estimate_asym1,method = "warp3")
      Marginal_likelihoods_bridge[j,2]=bridge1$logml
  
     model= model+1
     stan_file= here::here('src/stan_reparametrise_missing/metaphase_asymmetric_vminus_full_likelihood_reparametrised_missing.stan') #Asymmetry in v- variables
    #note that the file 'src/stan_files/metaphase_3d_v2.stan' has an alternative formulation of the metaphase model using the log_sum_exp operator which should avoid any numerical overflow/underflow but this seems to run several times slower than this version, parameter estimates are similar
    m <- stan_model(stan_file) #slightly different way to call a stan model, this compiles the model and the next line does the sampling
    estimate_asym2 <- sampling(m,data=stan_input,
                              seed = 42,
                              chains = 4,
	                            warmup = warm_up_iter,
         	                    iter = total_iter,init_r=0.1,
                              pars = c("eta","f","xi","auxStates","P","aux"),
                              include=FALSE, #avoid saving the params listed above
                              control=list(adapt_delta=0.95,max_treedepth=12))
    name2save <- paste("Asymmetric_full_vminus_",whole_name2,"_pair_",i,".rds",sep="")
    saveRDS(estimate_asym2,here::here(name2save))
  # if(max(summary(estimate_asym2)$summary[c(1:17),'Rhat'])<1.1){
    ############################################################################   

    bridge2<-bridge_sampler(estimate_asym2)
    print(bridge2$logml)
    #error_measures(bridge2)
    #bridge2=bridge_sampler(estimate_asym2,method = "warp3")
    Marginal_likelihoods_bridge[j,3]=bridge2$logml

  # } 
    model = model+1
    stan_file= here::here('src/stan_reparametrise_missing/metaphase_asymmetric_vplus_full_likelihood_reparametrised_missing.stan') #Asymmetry in v+ variables         #note that the file 'src/stan_files/metaphase_3d_v2.stan' has an alternative formulation of the metaphase model using the log_sum_exp operator which should avoid any numerical overflow/underflow but this seems to run several times slower than this version, parameter estimates are similar
    m <- stan_model(stan_file) #slightly different way to call a stan model, this compiles the model and the next line does the sampling
    estimate_asym3 <- sampling(m,
                              data=stan_input,
                              seed = 42,
                              chains = 4,
	                            warmup = warm_up_iter,
         	                    iter = total_iter,init_r=0.1,
                              pars = c("eta","f","xi","auxStates","P","aux"),
                              include=FALSE, #avoid saving the params listed above
                              control=list(adapt_delta=0.95,
                                           max_treedepth=12))
    name2save <- paste("Asymmetric_full_vplus_",whole_name2,"_pair_",i,".rds",sep="")
    saveRDS(estimate_asym3,here::here(name2save))     

    ############################################################################    

    bridge3=bridge_sampler(estimate_asym3)
    print(bridge3$logml)
    #bridge3=bridge_sampler(estimate_asym3,method = "warp3")
    Marginal_likelihoods_bridge[j,4]=bridge3$logml
    model = model+1
    stan_file= here::here('src/stan_reparametrise_missing/metaphase_asymmetric_vminusvplus_full_likelihood_reparametrised_missing.stan') #Asymmetry in v-,v+ variables
    #note that the file 'src/stan_files/metaphase_3d_v2.stan' has an alternative formulation of the metaphase model using the log_sum_exp operator which should avoid any numerical overflow/underflow but this seems to run several times slower than this version, parameter estimates are similar
    m <- stan_model(stan_file) #slightly different way to call a stan model, this compiles the model and the next line does the sampling
    estimate_asym4 <- sampling(m,
                              data=stan_input,
                              seed = 42,
                              chains = 4,
	                            warmup = warm_up_iter,
         	                    iter = total_iter,init_r=0.1,
                              pars = c("eta","f","xi","auxStates","P","aux"),
                              include=FALSE, #avoid saving the params listed above
                              control=list(adapt_delta=0.95,max_treedepth=12))
    name2save <- paste("Asymmetric_full_vminus_vplus_",whole_name2,"_pair_",i,".rds",sep="")
    saveRDS(estimate_asym4,here::here(name2save))
 #    post_asym_4=as.matrix( estimate_asym4)

# if(max(summary(estimate_asym4)$summary[c(1:17),'Rhat'])<1.1){
      ############################################################################    

    
    bridge4<-bridge_sampler(estimate_asym4)
    print(bridge4$logml)
    #bridge4=bridge_sampler(estimate_asym4,method = "warp3")
    Marginal_likelihoods_bridge[j,5]=bridge4$logml
    model = model+1
    ###Symmetric metaphase model
    stan_file= here::here('src/stan_reparametrise_missing/metaphase_symmetric_full_likelihood_missing.stan')#Symmetric with full likelihood for using bridge sampling
   #note that the file 'src/stan_files/metaphase_3d_v2.stan' has an alternative formulation of the metaphase model using the log_sum_exp operator which should avoid any numerical overflow/underflow but this seems to run several times slower than this version, parameter estimates are similar
  m <- stan_model(stan_file) #slightly different way to call a stan model, this compiles the model and the next line does the sampling
    symmetric <- sampling(m,data=stan_input,
                          seed = 42,
                          chains = 4,
	                        warmup = warm_up_iter,
         	                iter = total_iter,init_r=0.1,
                          pars = c("eta","f","xi","auxStates","P","aux"),
                          include=FALSE, #avoid saving the params listed above
                          control=list(adapt_delta=0.95,max_treedepth=12))
    name2save <- paste("Symmetric_",whole_name2,"_pair_",i,".rds",sep="")
     saveRDS(symmetric,here::here(name2save))
      ############################################################################    

     bridge5=bridge_sampler(symmetric)
    print(bridge5$logml)
     Marginal_likelihoods_bridge[j,6]=bridge5$logml 

#     par(mfrow=c(2,3))
#plot(h_states,col="blue",type="l",pch=3)
# plot(Mp_states_1,col="red",type="l",pch=10,main="Full Asymmetric")
# plot(Mp_states_2,col="red",type="l",pch=10,main="Asymmetry in v_")
# plot(Mp_states_3,col="red",type="l",pch=10,main="Asymmetry in v+")
# plot(Mp_states_4,col="red",type="l",pch=10, main="Asymmetry in v_, v+")
# plot(Mp_states_5,col="red",type="l",pch=10,main= "Symmetric")
# 
       
     Bayes_Factors_bridge[1+(j-1)*5,]=c(i,bridge1$logml,bridgesampling::bf(bridge1,bridge2)[1],bridgesampling::bf(bridge1,bridge3)[1],bridgesampling::bf(bridge1,bridge4)[1],bridgesampling::bf(bridge1,bridge5)[1], bridgesampling::post_prob(bridge1,bridge2,bridge3,bridge4,bridge5)[[1]])
     Bayes_Factors_bridge[2+(j-1)*5,]=c(i,bridgesampling::bf(bridge2,bridge1)[1],bridge2$logml,bridgesampling::bf(bridge2,bridge3)[1],bridgesampling::bf(bridge2,bridge4)[1],bridgesampling::bf(bridge2,bridge5)[1], bridgesampling::post_prob(bridge1,bridge2,bridge3,bridge4,bridge5)[[2]])
     Bayes_Factors_bridge[3+(j-1)*5,]=c(i,bridgesampling::bf(bridge3,bridge1)[1],bridgesampling::bf(bridge3,bridge2)[1],bridge3$logml,bridgesampling::bf(bridge3,bridge4)[1],bridgesampling::bf(bridge3,bridge5)[1], bridgesampling::post_prob(bridge1,bridge2,bridge3,bridge4,bridge5)[[3]])
     Bayes_Factors_bridge[4+(j-1)*5,]=c(i,bridgesampling::bf(bridge4,bridge1)[1],bridgesampling::bf(bridge4,bridge2)[1],bridgesampling::bf(bridge4,bridge3)[1],bridge4$logml,bridgesampling::bf(bridge4,bridge5)[1], bridgesampling::post_prob(bridge1,bridge2,bridge3,bridge4,bridge5)[[4]])
     Bayes_Factors_bridge[5+(j-1)*5,]=c(i,bridgesampling::bf(bridge5,bridge1)[1],bridgesampling::bf(bridge5,bridge2)[1],bridgesampling::bf(bridge5,bridge3)[1],bridgesampling::bf(bridge5,bridge4)[1],bridge5$logml, bridgesampling::post_prob(bridge1,bridge2,bridge3,bridge4,bridge5)[[5]])
     print(i)
     print(j)
     j=j+1
     
      Model_post_prob_bridge=exp(Marginal_likelihoods_bridge[,2:6])/rowSums(exp(Marginal_likelihoods_bridge[,2:6]))
      Model_post_prob_bridge=as.data.frame(Model_post_prob_bridge)

  write.csv( Marginal_likelihoods_bridge,here::here(paste0("Marginal_likelihoods_bridge_",whole_name2,".csv")), row.names = FALSE)
  write.csv(Bayes_Factors_bridge,here::here(paste0("Bayes_factors_bridge_",whole_name2,".csv")), row.names = FALSE)  
  }
 
  Model_post_prob_bridge=exp(Marginal_likelihoods_bridge[,2:6])/rowSums(exp(Marginal_likelihoods_bridge[,2:6]))
  Model_post_prob_bridge=as.data.frame(Model_post_prob_bridge)
  
  write.csv( Marginal_likelihoods_bridge,here::here(paste0("Marginal_likelihoods_bridge_",whole_name2,".csv")), row.names = FALSE)
  write.csv(Bayes_Factors_bridge,here::here(paste0("Bayes_factors_bridge_",whole_name2,".csv")), row.names = FALSE)  
 write_csv(Model_post_prob_bridge,here::here(paste0("Model_posterior_bridge_",whole_name2,".csv")))  

    
```

Now we can look at MCMC trace plots for the metaphase model. 


<!-- ```{r} -->
<!-- #pairwise posterior distributions -->
<!-- bayesplot_theme_set(theme_bw()) -->
<!-- pars_to_plot = c("tau","alpha","kappa","v_minus","v_plus","p_coh","p_icoh","L") -->
<!-- color_scheme_set("purple") -->
<!-- posterior <- as.array(estimate) -->
<!-- mcmc_trace(posterior,pars=pars_to_plot) -->

<!-- ``` -->


